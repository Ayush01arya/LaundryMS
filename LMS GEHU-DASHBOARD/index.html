<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>Graphic Era Hill University</title>
 <link rel="icon" href="Group.png" type="image/x-icon">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#"><b><img src="Group.png" width="50" height="50" > Graphic Era  Hill University</b></a></nav>


<br>

        <ul class="nav nav-pills mb-3  "  id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-toggle="pill" href="#home" role="tab" aria-controls="home" aria-selected="true" >Home</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-toggle="pill" href="#profile" role="tab" aria-controls="profile" aria-selected="false">VSDC</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="contact-tab" data-toggle="pill" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Complaints</a>
            </li>
             

        </ul>
    </nav>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="container">
                <div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4">Laundry Management System </h1>
    <p class="lead">The Laundry Management System is a software solution designed to streamline and automate laundry operations in institutions such as hotels, hospitals, and universities. It facilitates scheduling, tracking, and managing laundry tasks, improving efficiency, reducing errors, and enhancing overall productivity in handling laundry services.</p>
  </div>
</div>
            </div>
        </div>
        <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="container">

        <div id="notification"></div>
        <div class="search-container mt-4">
            <form onsubmit="searchUser(); return false;">
                <div class="form-group">
                    <label for="phoneNumber">Search by Phone Number:</label>
                    <input type="text" class="form-control" id="phoneNumber" placeholder="Enter phone number" required>
                </div>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>

        <div class="table-responsive" id="userDataContainer" style="display: none;">
            <h3 class="mt-5">User Data</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Email</th>
                        <th>Full Name</th>
                        <th>Hostel ID</th>
                        <th>Phone Number</th>
                        <th>Hostel Name</th>
                        <th>Last Login</th>
                        <th>Total Laundry Items</th>
                        <th>Verified</th>
                    </tr>
                </thead>
                <tbody id="userData">
                    <!-- Data will be dynamically populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal for displaying detailed user information -->
    <div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">User Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>Email:</strong> <span id="modalEmail"></span></p>
                    <p><strong>Full Name:</strong> <span id="modalFullName"></span></p>
                    <p><strong>Hostel ID:</strong> <span id="modalHostelID"></span></p>
                    <p><strong>Phone Number:</strong> <span id="modalPhoneNumber"></span></p>
                    <p><strong>Hostel Name:</strong> <span id="modalHostelName"></span></p>
                    <p><strong>Last Login:</strong> <span id="modalLastLogin"></span></p>
                    <h5>Laundry Items</h5>
                    <div id="laundryDetails"></div>
                    <p><strong>Verification Status:</strong> <span id="modalVerificationStatus"></span></p>
                </div>
                <div class="modal-footer">
                    <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    <button type="button" class="btn btn-danger" id="deleteButton">Delete</button>
    <button type="button" class="btn btn-warning" id="notVerifiedButton">Not Verified</button>
    <button type="button" class="btn btn-primary" id="verifyButton">Verify</button>
</div>

                </div>
            </div>
        </div>
    </div>
        </div>
        <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
No Complaints 
    </div>


        </div>
        <div class="tab-pane fade" id="view" role="tabpanel" aria-labelledby="view-tab">


        </div>





    </div>
<br>
<center><small>@Ayush Arya</small></center>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCU2emZdFy_1WNcdp4WVuXQlGNXzrqxTf4",
  authDomain: "gehubtl-lms.firebaseapp.com",
  databaseURL: "https://gehubtl-lms-default-rtdb.firebaseio.com",
  projectId: "gehubtl-lms",
  storageBucket: "gehubtl-lms.appspot.com",
  messagingSenderId: "233676261701",
  appId: "1:233676261701:web:e37e43b0d93b15efe0962c",
  measurementId: "G-06ESPH6BG5"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Function to fetch and display user data
        function fetchUserData() {
            const userDataTbody = document.getElementById('userData');
            userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">Loading user data...</td></tr>';

            database.ref('users').once('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    let html = '';
                    Object.keys(userData).forEach((userId) => {
                        const user = userData[userId];
                        let totalLaundryItems = 0;
                        if (user.Laundry) {
                            Object.keys(user.Laundry).forEach(date => {
                                totalLaundryItems += user.Laundry[date].total || 0;
                            });
                        }
                        html += `<tr onclick="showUserDetails('${userId}')"><td>${user.email}</td><td>${user.full_name}</td><td>${user.hostel_id}</td><td>${user.phone_number}</td><td>${user.hostel_name}</td><td>${user.last_login}</td><td>${totalLaundryItems}</td><td>${user.verified ? 'Yes' : 'No'}</td></tr>`;
                    });
                    userDataTbody.innerHTML = html;
                } else {
                    userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">No user data found</td></tr>';
                }
            }, (error) => {
                console.error('Error fetching user data:', error);
                userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">Error fetching user data</td></tr>';
            });
        }

        // Call fetchUserData function when the page loads
        fetchUserData();

        // Function to search for user by phone number
        function searchUser() {
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            if (phoneNumber === '') {
                alert('Please enter a phone number to search.');
                return;
            }

            const userDataTbody = document.getElementById('userData');
            userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">Searching user data...</td></tr>';

            database.ref('users').orderByChild('phone_number').equalTo(phoneNumber).once('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    let html = '';
                    Object.keys(userData).forEach((userId) => {
                        const user = userData[userId];
                        let totalLaundryItems = 0;
                        if (user.Laundry) {
                            Object.keys(user.Laundry).forEach(date => {
                                totalLaundryItems += user.Laundry[date].total || 0;
                            });
                        }
                        html += `<tr onclick="showUserDetails('${userId}')"><td>${user.email}</td><td>${user.full_name}</td><td>${user.hostel_id}</td><td>${user.phone_number}</td><td>${user.hostel_name}</td><td>${user.last_login}</td><td>${totalLaundryItems}</td><td>${user.verified ? 'Yes' : 'No'}</td></tr>`;
                    });
                    userDataTbody.innerHTML = html;
                    document.getElementById('userDataContainer').style.display = 'block';
                } else {
                    userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">No user found with this phone number</td></tr>';
                }
            }, (error) => {
                console.error('Error searching user data:', error);
                userDataTbody.innerHTML = '<tr><td colspan="8" class="text-center">Error searching user data</td></tr>';
            });
        }

        // Function to show detailed user information in a modal
        function showUserDetails(userId) {
    database.ref('users/' + userId).once('value', (snapshot) => {
        const user = snapshot.val();
        if (user) {
            document.getElementById('modalEmail').textContent = user.email;
            document.getElementById('modalFullName').textContent = user.full_name;
            document.getElementById('modalHostelID').textContent = user.hostel_id;
            document.getElementById('modalPhoneNumber').textContent = user.phone_number;
            document.getElementById('modalHostelName').textContent = user.hostel_name;
            document.getElementById('modalLastLogin').textContent = user.last_login;
            document.getElementById('modalVerificationStatus').textContent = user.verified ? 'Verified' : 'Not Verified';

            const laundryDetailsDiv = document.getElementById('laundryDetails');
            laundryDetailsDiv.innerHTML = '';

            if (user.Laundry) {
                Object.keys(user.Laundry).forEach(date => {
                    const laundryEntry = user.Laundry[date];
                    const entryDiv = document.createElement('div');
                    entryDiv.innerHTML = `<p><strong>Date:</strong> ${date}</p><p><strong>Items:</strong> Paint: ${laundryEntry.Paint}, Time: ${laundryEntry.time}, Total: ${laundryEntry.total}</p>`;
                    laundryDetailsDiv.appendChild(entryDiv);
                });
            }

            const verifyButton = document.getElementById('verifyButton');
            verifyButton.onclick = () => verifyLaundry(userId);

            const deleteButton = document.getElementById('deleteButton');
            deleteButton.onclick = () => deleteUser(userId);

            const notVerifiedButton = document.getElementById('notVerifiedButton');
            notVerifiedButton.onclick = () => markAsNotVerified(userId);

            $('#userModal').modal('show');
        }
    }, (error) => {
        console.error('Error fetching user details:', error);
    });
}


        // Function to verify laundry information
        function verifyLaundry(userId) {
            // Update the verification status in the database
            database.ref('users/' + userId + '/verified').set(true, (error) => {
                if (error) {
                    console.error('Error updating verification status:', error);
                    alert('Error updating verification status');
                } else {
                    alert('User laundry information verified successfully');
                    $('#userModal').modal('hide');
                    fetchUserData();
                }
            });
        }
// Function to delete user data
function deleteUser(userId) {
    if (confirm("Are you sure you want to delete this user?")) {
        database.ref('users/' + userId).remove()
            .then(() => {
                alert("User data deleted successfully");
                $('#userModal').modal('hide');
                fetchUserData(); // Refresh the user data table
            })
            .catch((error) => {
                console.error('Error deleting user data:', error);
                alert("Error deleting user data");
            });
    }
}
// Function to mark user as not verified
function markAsNotVerified(userId) {
    if (confirm("Are you sure you want to mark this user as Not Verified?")) {
        database.ref('users/' + userId + '/verified').set(false, (error) => {
            if (error) {
                console.error('Error marking user as Not Verified:', error);
                alert('Error marking user as Not Verified');
            } else {
                alert('User marked as Not Verified successfully');
                $('#userModal').modal('hide');
                fetchUserData(); // Refresh the user data table
            }
        });
    }
}
// Function to show detailed user information in a modal
   function showUserDetails(userId) {
        database.ref('users/' + userId).once('value', (snapshot) => {
            const user = snapshot.val();
            if (user) {
                document.getElementById('modalEmail').textContent = user.email;
                document.getElementById('modalFullName').textContent = user.full_name;
                document.getElementById('modalHostelID').textContent = user.hostel_id;
                document.getElementById('modalPhoneNumber').textContent = user.phone_number;
                document.getElementById('modalHostelName').textContent = user.hostel_name;
                document.getElementById('modalLastLogin').textContent = user.last_login;
                document.getElementById('modalVerificationStatus').textContent = user.verified ? 'Verified' : 'Not Verified';

                const laundryDetailsDiv = document.getElementById('laundryDetails');
                laundryDetailsDiv.innerHTML = '';

                if (user.Laundry) {
                    Object.keys(user.Laundry).forEach(date => {
                        const laundryEntry = user.Laundry[date];
                        const entryDiv = document.createElement('div');
                        entryDiv.innerHTML = `<p><strong>Date:</strong> ${date}</p><p><strong>Items:</strong> Paint: ${laundryEntry.Paint}, Time: ${laundryEntry.time}, Total: ${laundryEntry.total}</p>`;
                        laundryDetailsDiv.appendChild(entryDiv);
                    });
                }

                const verifyButton = document.getElementById('verifyButton');
                verifyButton.onclick = () => verifyLaundry(userId);

                const deleteButton = document.getElementById('deleteButton');
                deleteButton.onclick = () => deleteUser(userId);

                const notVerifiedButton = document.getElementById('notVerifiedButton');
                notVerifiedButton.onclick = () => markAsNotVerified(userId);

                $('#userModal').modal('show');
            }
        }, (error) => {
            console.error('Error fetching user details:', error);
        });
    }

    </script>

</body>
</html>
